# EventReplayKafka
The responsibility of this service is to pull FHIR messages from the hops-EventStore API and publish them on a Kafka-topic.

Messages should be published in order and without duplicates; this is done by running the publishing loop on a single thread on a single instance. Every messages is published with a custom-header: `HOPS-Source-Offset`. The value of this header represents the offset within the query to hops-EventStore, **not** the topic offset, and is used by the EventReplayer to resume where it left off after a restart.

Every message also includes a *Content-Type* header with value: `application/fhir+json; fhirVersion=4.0`, according to the [Mime Type Parameter](https://www.hl7.org/fhir/versioning.html#mt-version) in the spec.. This header is added in order to support future formats and versions on the same topic.

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcGFydGljaXBhbnQgUiBhcyBFdmVudFJlcGxheVxuICAgIHBhcnRpY2lwYW50IEUgYXMgRXZlbnRTdG9yZVxuICAgIHBhcnRpY2lwYW50IEsgYXMgS2Fma2FcbiAgICBSLT4-SzogR2V0IHNvdXJjZS1vZmZzZXQgZnJvbSBsYXRlc3QgUmVjb3JkXG4gICAgYWN0aXZhdGUgUlxuICAgIGFjdGl2YXRlIEtcbiAgICBLLT4-Ujogc291cmNlLW9mZnNldFxuICAgIGRlYWN0aXZhdGUgS1xuICAgIGxvb3BcbiAgICBSLT4-RTogR2V0IEZISVIgTWVzc2FnZSBhdCBzb3VyY2Utb2Zmc2V0XG4gICAgYWN0aXZhdGUgRVxuICAgIEUtPj5SOiBGSElSIE1lc3NhZ2Uge2pzb259XG4gICAgZGVhY3RpdmF0ZSBFXG4gICAgUi0-Pks6IFB1Ymxpc2ggRkhJUiBNZXNzYWdlLCBoZWFkZXI9c291cmNlLW9mZnNldFxuICAgIFItPj5SOiBJbmNyZW1lbnQgc291cmNlLW9mZnNldFxuICAgIGRlYWN0aXZhdGUgUlxuICAgIGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcGFydGljaXBhbnQgUiBhcyBFdmVudFJlcGxheVxuICAgIHBhcnRpY2lwYW50IEUgYXMgRXZlbnRTdG9yZVxuICAgIHBhcnRpY2lwYW50IEsgYXMgS2Fma2FcbiAgICBSLT4-SzogR2V0IHNvdXJjZS1vZmZzZXQgZnJvbSBsYXRlc3QgUmVjb3JkXG4gICAgYWN0aXZhdGUgUlxuICAgIGFjdGl2YXRlIEtcbiAgICBLLT4-Ujogc291cmNlLW9mZnNldFxuICAgIGRlYWN0aXZhdGUgS1xuICAgIGxvb3BcbiAgICBSLT4-RTogR2V0IEZISVIgTWVzc2FnZSBhdCBzb3VyY2Utb2Zmc2V0XG4gICAgYWN0aXZhdGUgRVxuICAgIEUtPj5SOiBGSElSIE1lc3NhZ2Uge2pzb259XG4gICAgZGVhY3RpdmF0ZSBFXG4gICAgUi0-Pks6IFB1Ymxpc2ggRkhJUiBNZXNzYWdlLCBoZWFkZXI9c291cmNlLW9mZnNldFxuICAgIFItPj5SOiBJbmNyZW1lbnQgc291cmNlLW9mZnNldFxuICAgIGRlYWN0aXZhdGUgUlxuICAgIGVuZCIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)