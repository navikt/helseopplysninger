# EventSinkKafka
The responsibility of this service is to pull FHIR Messages from a Kafka topic and POST them to the **hops-EventStore** API.

There is no need for any state handling except for the consumer offset, because the EventStore's [$process-message](https://www.hl7.org/fhir/operation-messageheader-process-message.html) endpoint is idempotent with respect to the Message ID.

The content of the Kafka records will be forwarded unmodified to the EventStore. If the format or invariants are invalid, the EventStore will return a 4xx HTTP status with a [descriptive message](http://www.hl7.org/fhir/operationoutcome.html). Such errors are currently only logged by the EventSink, but it might be necessary to store this in a **Dead letter queue**.

[![](https://mermaid.ink/img/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcGFydGljaXBhbnQgUyBhcyBFdmVudFNpbmtcbiAgICBwYXJ0aWNpcGFudCBFIGFzIEV2ZW50U3RvcmVcbiAgICBwYXJ0aWNpcGFudCBLIGFzIEthZmthXG4gICAgbG9vcFxuICAgIFMtPj5LOiBHZXQgRkhJUiBNZXNzYWdlXG4gICAgYWN0aXZhdGUgU1xuICAgIEstPj5TOiBGSElSIE1lc3NhZ2VcbiAgICBTLT4-RTogUE9TVCAvJHByb2Nlc3MtbWVzc2FnZVxuICAgIGFjdGl2YXRlIEVcbiAgICBFLT4-UzogQWNjZXB0ZWRcbiAgICBkZWFjdGl2YXRlIEVcbiAgICBTLT4-SzogVXBkYXRlIG9mZnNldFxuICAgIGRlYWN0aXZhdGUgU1xuICAgIGVuZCIsIm1lcm1haWQiOnsidGhlbWUiOiJkZWZhdWx0In0sInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0)](https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG4gICAgcGFydGljaXBhbnQgUyBhcyBFdmVudFNpbmtcbiAgICBwYXJ0aWNpcGFudCBFIGFzIEV2ZW50U3RvcmVcbiAgICBwYXJ0aWNpcGFudCBLIGFzIEthZmthXG4gICAgbG9vcFxuICAgIFMtPj5LOiBHZXQgRkhJUiBNZXNzYWdlXG4gICAgYWN0aXZhdGUgU1xuICAgIEstPj5TOiBGSElSIE1lc3NhZ2VcbiAgICBTLT4-RTogUE9TVCAvJHByb2Nlc3MtbWVzc2FnZVxuICAgIGFjdGl2YXRlIEVcbiAgICBFLT4-UzogQWNjZXB0ZWRcbiAgICBkZWFjdGl2YXRlIEVcbiAgICBTLT4-SzogVXBkYXRlIG9mZnNldFxuICAgIGRlYWN0aXZhdGUgU1xuICAgIGVuZCIsIm1lcm1haWQiOiJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCJ1cGRhdGVFZGl0b3IiOmZhbHNlLCJhdXRvU3luYyI6dHJ1ZSwidXBkYXRlRGlhZ3JhbSI6ZmFsc2V9)